<!DOCTYPE html> <!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]--> <!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]--> <!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]--> <head> <meta charset="utf-8"> <title>@Lenciel</title> <meta name="author" content="Lenciel"> <meta name="description" content=" 品味时尚 2009-06-09 21:25:00 ..."> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="canonical" href="http://lenciel.com/posts/78/"> <link href="/favicon.png" rel="icon"> <script src="/assets/javascripts/app.js"></script> <link href="http://feeds.feedburner.com/github/lenciel" rel="alternate" title="@Lenciel" type="application/atom+xml"> <meta property="og:type" content="article"/> <meta property="og:url" content="http://lenciel.com/posts/78/"/> <meta property="og:description" content=" 品味时尚 2009-06-09 21:25:00 ..."/> <meta property="og:site_name" content="http://lenciel.com"/> <meta property="article:author" content="http://lenciel.com"> <meta itemprop="description" content=" 品味时尚 2009-06-09 21:25:00 ..."/> <script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?42345b94bf173b38bef61f873677adfa";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script> <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-175991-6', 'auto');
    ga('send', 'pageview');

</script> </head> <body class="collapse-sidebar sidebar-footer"> <header role="banner"><hgroup> <h1><a href="/">@Lenciel</a></h1> </hgroup> </header> <nav role="navigation"><ul class="subscription" data-subscription="rss"> <li><a href="http://feeds.feedburner.com/github/lenciel" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li> </ul> <ul class="main-navigation"> <li><a href="/"><i class="icon-home"></i>Home</a></li> <li><a href="/archives"><i class="icon-book-alt"></i>Archives</a><span class="divider"></span></li> <li><a href="/about"><i class="icon-user"></i>About</a><span class="divider"></span></li> </ul> </nav> <div id="main"> <div id="content"> <div class="blog-index"> <article> <header> <h1 class="entry-title"><a href="/2009/06/kill-yourself-in-a-fashion-way/">品味时尚</a></h1> <p class="meta"> <time class='entry-date' datetime='2009-06-09 21:25:00 +0800'> <span class='date'>2009-06-09</span> <span class='time'>21:25:00</span> </time> </p> </header> <div class="entry-content"><p><img title="fashion" style="border-right: 0px; border-top: 0px; display: inline; border-left: 0px; border-bottom: 0px" height="324" alt="fashion" src="/downloads/images/fashion.jpg" width="484" border="0"/></p> <p>每年高考的时候，本座都特别期待江苏的作文题。因为传说中江苏的语文老师每年聚在一起都不骂国足是猪，而是骂作文命题老师是猪：对国足，他们还总是能猜中结果，而作文题，他们边都摸不着。</p> <p>这次就果然又很特立独行的一猪哇：<a href="http://edu.qq.com/a/20090608/000172.htm" target="_blank">品味时尚</a>。</p> <p>该作文题还有立意的提示信息：</p> <blockquote><p>人们追逐时尚，不是因为它适合自己的气质，而只是因为大家都是如此。</p></blockquote> <p>不知道这个老师是不是个反非主流斗士，出了这么个题目：说实话，现在的小孩子走出来，没有比非主流更主流的打扮了。</p> <p>于是同学们为了中举，都会忽悠老师说，时尚应该是自信，又或者是绿色，又或者是环保，又或者是本真，于是就显得自己人生观世界观狂成熟狂完满，即使行走在物欲横流的今天，也能百毒不侵了。</p> <p>只是无论如何，我们总还是有条件不好的孩子。他也许读书就是为了扔掉锄头，能让自己的家族到城市里，过体面的生活，却只好写，“我虽然无法上网，甚至看不到电视。除开读书，还要帮家里干农活，但是我觉得时尚其实是本真。我现在的生活就挺好的，那些人人都追求的东西，房子，金钱，并不适合我的气质”。</p> <p>不知道这种话，如果叫命题老师自己去写，他会不会边写边吐。</p> <p>其实，对本座来说，最近正好有一个有趣的新闻，非常的“时尚”。</p> <p>大家都知道，《Kill Bill》里面的Bill，最近挂了：是真的把自己挂起来了。不过，如果你用不同的关键字去搜索，会得出蛮有趣的结果。</p> <blockquote><p>心地纯良如偶像派的时尚品味者：<a href="http://www.google.com/search?hl=en&q=kill+bill+%E4%B8%BB%E8%A7%92+%E8%87%AA%E6%9D%80&sourceid=navclient-ff&rlz=1B3GGGL_zh-CN___CN231&ie=UTF-8" target="_blank">click</a></p> <p>心地不纯良如本座的时尚品味者：<a href="http://www.google.com/search?hl=en&q=kill+bill+%E4%B8%BB%E8%A7%92+%E8%87%AA%E6%85%B0&sourceid=navclient-ff&rlz=1B3GGGL_zh-CN___CN231&ie=UTF-8" target="_blank">click</a></p></blockquote> <p>嗯哼……其实大家不要觉得从事“手工业”的时候出事有什么奇怪的。本座在以前看<a href="http://en.wikipedia.org/wiki/Chuck_Palahniuk" target="_blank">Chuck</a>大叔<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> 那篇著名的<a href="http://chuckpalahniuk.net/features/shorts/guts" target="_blank">Guts</a>的时候（已经有人<a href="http://www.verycd.com/groups/@g2386100/683454.topic" target="_blank">翻译</a>，慎入！！）有读到过一段：</p> <blockquote><p>Looking back, kid-psych experts, school counselors now say that most of the last peak in teen suicide was kids trying to choke while they beat off. Their folks would find them, a towel twisted around the kid&#8217;s neck, the towel tied to the rod in their bedroom closet, the kid dead. Dead sperm everywhere. Of course the folks cleaned up. They put some pants on their kid. They made it look… better. Intentional at least. The regular kind of sad, teen suicide.</p></blockquote> <p>嗯哼……所以有的时候时尚人士莫名其妙的自缢，是没有那么悲情的。</p> <p>这又让本座想起来，世界上有两种动物，因为特别重视配偶闻名。一种就是俺们国鸟丹顶鹤<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> 。诗经说丫们谈起恋爱“鹤鸣九皋，声闻于天”。而且一方去世，另一方一定会孤单终老（要知道丹顶鹤可以活60岁左右）。</p> <p>甚至有一种颇有争论的说法是，只要双方有一个意外死去，另外一个不久就会把自己的脖子打一个结，跟着死去。</p> <p>每次本座看到人们这样的议论时，总是会有一些心地不纯良的时尚品味在心头默默的泛起<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup> 。</p> <p>可惜啊，老师，您看我肚子里面这么有货，却没法跟您一起品味时尚。</p> <div class="footnotes"> <hr/> <ol> <li id="fn:1"> <p>这位大叔不是写黄书的，写的第一篇长篇小说叫做，《<a href="http://www.imdb.com/title/tt0137523/" target="_blank">Fight Club</a>》。<a href="#fnref:1" rev="footnote">&#8617;</a></p></li> <li id="fn:2"> <p>还有一种是鸳鸯么？ <a href="#fnref:2" rev="footnote">&#8617;</a></p></li> <li id="fn:3"> <p>请问这样是不是比较隐晦一点…<a href="#fnref:3" rev="footnote">&#8617;</a></p></li> </ol> </div> </div> </article> <article> <header> <h1 class="entry-title"><a href="/2009/04/ssh-using-paramiko/">使用paramiko进行ssh工作</a></h1> <p class="meta"> <time class='entry-date' datetime='2009-04-23 00:37:00 +0800'> <span class='date'>2009-04-23</span> <span class='time'>00:37:00</span> </time> </p> </header> <div class="entry-content"><p>最近在单位写一个自动build的小工具。因为clearcase的<code>setview</code>命令实际上是激活一个新的<code>shell</code>，所以用简单的“串通”<code>shell</code>的脚本很难做到。</p> <p>因为在邮件组里面看到有同样问题的Matt说用<code>paramiko</code>解决了问题，就试了试，过程还颇有点艰辛。</p> <p>首先，<code>paramiko</code>没有直接的<code>msi</code>或者<code>exe</code>版本给<code>Windows</code>用户下载，而是需要在本地进行编译。而且<code>python</code>的<code>easy_install</code>工具在Vista下面会报错，所以至少花了十几分钟才算安装完毕。</p> <p>结果在用test.py验证安装的时候就报错了，说什么：</p> <figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span></span><span class="n">paramiko</span><span class="o">.</span><span class="n">SSHException</span><span class="p">:</span> <span class="n">No</span> <span class="n">suitable</span> <span class="n">address</span>
</span></code></pre></td></tr></table></div></figure> <p>安装是我自己一步步弄得，难道搞错了？只好照着demo写了一个sftp的脚本，发现是可以跑的，干。</p> <p>只好丢了封信给邮件组，然后自己开始找是啥问题。丢给邮件组的信至今没有回音（人气不行啊，<code>paramiko</code>），问题还是找到了。原来是1.7.5的<code>paramiko</code>增加了对ipv6的支持，结果引入了错误。更新了<code>client.py</code>后重新编译就可以用了。</p> <p>最后，虽然demo的例子也挺多，但是好像没有说清楚怎么用invoke_shell和get_pty以及照例奉上一段代码。</p> <figure class='code'><figcaption><span> (paramiko_sample.py)</span> <a href='/downloads/code/paramiko_sample.py'>download</a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span></span><span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">This script is using for build the software package</span>
</span><span class='line'><span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">time</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">paramiko</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">traceback</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">ConfigParser</span>
</span><span class='line'>
</span><span class='line'><span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">The main class of the builder.</span>
</span><span class='line'><span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Builder</span><span class="p">:</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;Parses options from the ini file to create connection.&quot;&quot;&quot;</span>
</span><span class='line'>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inifile</span><span class="p">):</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
</span><span class='line'>            <span class="n">config</span><span class="o">.</span><span class="n">readfp</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">inifile</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">,</span><span class="s1">&#39;server&#39;</span><span class="p">),</span>
</span><span class='line'>                              <span class="n">port</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">,</span> <span class="s1">&#39;port&#39;</span><span class="p">),</span>
</span><span class='line'>                              <span class="n">username</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">,</span><span class="s1">&#39;user&#39;</span><span class="p">),</span>
</span><span class='line'>                              <span class="n">password</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">,</span><span class="s1">&#39;password&#39;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">Transport</span><span class="p">((</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">,</span><span class="s1">&#39;server&#39;</span><span class="p">),</span> <span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">,</span> <span class="s1">&#39;port&#39;</span><span class="p">)))</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">.</span><span class="n">start_client</span><span class="p">()</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">.</span><span class="n">auth_password</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">,</span><span class="s1">&#39;user&#39;</span><span class="p">),</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">,</span><span class="s1">&#39;password&#39;</span><span class="p">))</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">_sftp</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SFTPClient</span><span class="o">.</span><span class="n">from_transport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>            <span class="k">print</span> <span class="s1">&#39;*** Caught exception: </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span class='line'>            <span class="k">try</span><span class="p">:</span>
</span><span class='line'>                <span class="bp">self</span><span class="o">.</span><span class="n">closeConn</span><span class="p">()</span>
</span><span class='line'>            <span class="k">except</span><span class="p">:</span>
</span><span class='line'>                <span class="k">pass</span>
</span><span class='line'>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_fpga</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fpga compress&#39;</span><span class="p">,</span><span class="s1">&#39;fpga&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_lpath</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fpga compress&#39;</span><span class="p">,</span><span class="s1">&#39;local_fpga_path&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_rpath</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fpga compress&#39;</span><span class="p">,</span><span class="s1">&#39;remote_fpga_path&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_oab</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fpga compress&#39;</span><span class="p">,</span><span class="s1">&#39;oab&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_xlf</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlf build&#39;</span><span class="p">,</span><span class="s1">&#39;xlf&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_lmid</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlf build&#39;</span><span class="p">,</span><span class="s1">&#39;lmid&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_xpp</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlf build&#39;</span><span class="p">,</span><span class="s1">&#39;xpp&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_xdp</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlf build&#39;</span><span class="p">,</span><span class="s1">&#39;xdp&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_rru</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlf build&#39;</span><span class="p">,</span><span class="s1">&#39;rru&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_rruswdb</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlf build&#39;</span><span class="p">,</span><span class="s1">&#39;rru_sw_db&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_xpl</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlf build&#39;</span><span class="p">,</span><span class="s1">&#39;xpl&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Your input fpga file is:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_lpath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_fpga</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Your ouput xlf file will be:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlf</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;Run command on the server&quot;&quot;&quot;</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">runCmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;run &lt;command&gt;</span>
</span><span class='line'><span class="sd">        Execute this command on all hosts in the list&quot;&quot;&quot;</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">command</span><span class="p">:</span>
</span><span class='line'>            <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span class='line'>            <span class="n">stdin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
</span><span class='line'>                <span class="k">print</span> <span class="n">line</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="k">print</span> <span class="s2">&quot;usage: run &lt;command&gt;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;Upload the fpga and compress it to oab.bin&quot;&quot;&quot;</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">createOab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_sftp</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lpath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_fpga</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_rpath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_fpga</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">runCmd</span><span class="p">(</span><span class="s2">&quot;hou_create_fpga -bf </span><span class="se">\&quot;</span><span class="s2">/home/ehholli/fpgainput/fpga.med</span><span class="se">\&quot;</span><span class="s2"> -dn </span><span class="se">\&quot;</span><span class="s2">CXC 172 8213/1</span><span class="se">\&quot;</span><span class="s2"> -of oab -dev </span><span class="se">\&quot;</span><span class="s2">XC2V6000,-4</span><span class="se">\&quot;</span><span class="s2"> -dir /home/ehholli/fpgaoutput/&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">_sftp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oab</span><span class="p">,</span><span class="s1">&#39;oab.bin&#39;</span><span class="p">)</span>
</span><span class='line'>            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Fpga file compress successfully!&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>            <span class="k">print</span> <span class="s1">&#39;*** Caught exception: </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span class='line'>            <span class="k">try</span><span class="p">:</span>
</span><span class='line'>                <span class="bp">self</span><span class="o">.</span><span class="n">closeConn</span><span class="p">()</span>
</span><span class='line'>            <span class="k">except</span><span class="p">:</span>
</span><span class='line'>                <span class="k">pass</span>
</span><span class='line'>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;Make the tlf&quot;&quot;&quot;</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">genXlf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c1">#open a interactive shell</span>
</span><span class='line'>        <span class="n">ct_chan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">.</span><span class="n">open_session</span><span class="p">()</span>
</span><span class='line'>        <span class="n">ct_chan</span><span class="o">.</span><span class="n">setblocking</span><span class="p">()</span>
</span><span class='line'>        <span class="n">ct_chan</span><span class="o">.</span><span class="n">get_pty</span><span class="p">()</span>
</span><span class='line'>        <span class="n">ct_chan</span><span class="o">.</span><span class="n">invoke_shell</span><span class="p">()</span>
</span><span class='line'>        <span class="c1">#ct setview ehholli</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">ct_chan</span><span class="o">.</span><span class="n">send_ready</span><span class="p">()):</span>
</span><span class='line'>            <span class="n">ct_chan</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;ct setview ehholli</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">#compile</span>
</span><span class='line'>        <span class="n">build_cmd</span><span class="o">=</span><span class="s2">&quot;/vobs/rbs/hw/bcp/xp/deliv/solaris2/bin/xlf_gen -r &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_xpp</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_xdp</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_rru</span> \
</span><span class='line'>                     <span class="o">+</span><span class="s2">&quot; -i &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_oab</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_rruswdb</span> \
</span><span class='line'>                     <span class="o">+</span><span class="s2">&quot; -o /home/ehholli/tmp/&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlf</span> \
</span><span class='line'>                     <span class="o">+</span><span class="s2">&quot; -x &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_xpl</span> \
</span><span class='line'>                     <span class="o">+</span><span class="s2">&quot; -lmid </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_lmid</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span> \
</span><span class='line'>                     <span class="o">+</span><span class="s2">&quot; -t </span><span class="se">\&quot;</span><span class="s2">au_applic</span><span class="se">\&quot;</span><span class="s2"> -v </span><span class="se">\r\n</span><span class="s2">&quot;</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="n">build_cmd</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">ct_chan</span><span class="o">.</span><span class="n">send_ready</span><span class="p">()):</span>
</span><span class='line'>            <span class="n">ct_chan</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">build_cmd</span><span class="p">)</span>
</span><span class='line'>        <span class="n">tCheck2</span> <span class="o">=</span>
</span><span class='line'>        <span class="k">while</span> <span class="ow">not</span> <span class="n">ct_chan</span><span class="o">.</span><span class="n">recv_ready</span><span class="p">():</span>
</span><span class='line'>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'>            <span class="n">tCheck2</span><span class="o">+=</span><span class="mi">1</span>
</span><span class='line'>            <span class="k">if</span> <span class="n">tCheck2</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
</span><span class='line'>                <span class="k">print</span> <span class="s1">&#39;time out&#39;</span><span class="c1">#TODO: add exeption here</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="n">ct_chan</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">65536</span><span class="p">))</span>
</span><span class='line'>        <span class="n">ct_chan</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span class='line'>        <span class="c1">#download the xlf file</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">_sftp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/home/ehholli/tmp/&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlf</span><span class="p">)</span>
</span><span class='line'>            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;xlf file downloaded successfully!&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>            <span class="k">print</span> <span class="s1">&#39;*** Caught exception: </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span class='line'>            <span class="k">try</span><span class="p">:</span>
</span><span class='line'>                <span class="bp">self</span><span class="o">.</span><span class="n">closeConn</span><span class="p">()</span>
</span><span class='line'>            <span class="k">except</span><span class="p">:</span>
</span><span class='line'>                <span class="k">pass</span>
</span><span class='line'>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;Close everything we opened&quot;&quot;&quot;</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">closeConn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_sftp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'><span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="c1"># setup logging</span>
</span><span class='line'>    <span class="n">paramiko</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">log_to_file</span><span class="p">(</span><span class="s1">&#39;demo_builder.log&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">b</span><span class="o">=</span><span class="n">Builder</span><span class="p">(</span><span class="s1">&#39;cfg.ini&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">b</span><span class="o">.</span><span class="n">createOab</span><span class="p">()</span>
</span><span class='line'>    <span class="n">b</span><span class="o">.</span><span class="n">genXlf</span><span class="p">()</span>
</span><span class='line'>    <span class="c1">#b.runCmd(&#39;ls&#39;)</span>
</span><span class='line'>    <span class="n">b</span><span class="o">.</span><span class="n">closeConn</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure> </div> </article> <div class="pagination"> <a class="prev" href="/posts/79">&larr; Older</a> <a href="/archives">Archives</a> <a class="next" href="/posts/77">Newer &rarr;</a> </div> </div> </div> </div> <footer role="contentinfo"><p> Blog theme: <a href="https://github.com/lenciel/jekyll-lenciel-theme">jekyll-lenciel-theme</a> <span class="theme-version">Copyright &copy; 2004-2017 by <a href="mailto:lenciel@gmail.com">Lenciel</a></span> </p> </footer> <script type="text/javascript">
  var stylesheet = document.createElement('link');
  stylesheet.href = '/assets/stylesheets/app.css';
  stylesheet.rel = 'stylesheet';
  stylesheet.type = 'text/css';
  document.getElementsByTagName('head')[0].appendChild(stylesheet);
</script> </body> </html>