<!DOCTYPE html> <!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]--> <!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]--> <!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]--> <head> <meta charset="utf-8"> <title>从Octopress转到纯Jekyll - @Lenciel</title> <meta name="author" content="Lenciel"> <meta name="description" content=" 从Octopress转到纯Jekyll 离开Wordpress改用Oct..."> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="canonical" href="http://lenciel.com/2017/03/migrating-from-octopress-to-jekyll/"> <link href="/favicon.png" rel="icon"> <script src="/assets/javascripts/app.js"></script> <link href="http://feeds.feedburner.com/github/lenciel" rel="alternate" title="@Lenciel" type="application/atom+xml"> <meta property="og:title" content="从Octopress转到纯Jekyll"/><meta itemprop="name" content="从Octopress转到纯Jekyll"/> <meta property="og:type" content="article"/> <meta property="og:url" content="http://lenciel.com/2017/03/migrating-from-octopress-to-jekyll/"/> <meta property="og:description" content=" 从Octopress转到纯Jekyll 离开Wordpress改用Oct..."/> <meta property="og:site_name" content="http://lenciel.com"/> <meta property="article:author" content="http://lenciel.com"> <meta property="article:published_time" content="2017-03-14 13:45:00 +0800"/> <meta property="article:section" content="blogjekylloctopresstools-i-use"/> <meta itemprop="description" content=" 从Octopress转到纯Jekyll 离开Wordpress改用Oct..."/> <script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?42345b94bf173b38bef61f873677adfa";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script> <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-175991-6', 'auto');
    ga('send', 'pageview');

</script> </head> <body class="collapse-sidebar sidebar-footer"> <header role="banner"><hgroup> <h1><a href="/">@Lenciel</a></h1> </hgroup> </header> <nav role="navigation"><ul class="subscription" data-subscription="rss"> <li><a href="http://feeds.feedburner.com/github/lenciel" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li> </ul> <ul class="main-navigation"> <li><a href="/"><i class="icon-home"></i>Home</a></li> <li><a href="/archives"><i class="icon-book-alt"></i>Archives</a><span class="divider"></span></li> <li><a href="/about"><i class="icon-user"></i>About</a><span class="divider"></span></li> </ul> </nav> <div id="main"> <div id="content"> <div> <article class="hentry" role="article"> <header> <h1 class="entry-title">从Octopress转到纯Jekyll</h1> <p class="meta"> <time class='entry-date' datetime=''> <span class='date'></span> <span class='time'></span> </time> </p> </header> <div class="entry-content"><p>离开Wordpress<a href="http://lenciel.com/2013/03/blog-with-octopress-and-github-pages/">改用Octopress</a>写blog已经好些年了，本座甚至还写了一个自己的<a href="https://github.com/lenciel/octopress-theme-lenciel">Octopress模板</a>。之所以要迁移主要是Octopress作为以Jekyll为基础的一套脚手架，自2011年发布以后进展非常缓慢，和Jekyll的快速更新很难对齐。</p> <p>在近期跳票多次的<a href="http://octopress.org/2015/01/15/octopress-3.0-is-coming/">Octopress3</a>终于发布了之后，看了一下没有什么值得迁移的新功能。所以不管是从功能、性能还是开发活跃度上，继续跟Octopress都不太明智，就决定转用纯Jekyll。</p> <p>迁移过程还算比较平滑，主要是：</p> <ul> <li>Blog项目的迁移</li> <li>模板项目的迁移</li> </ul> <a name="Blog..............."></a> <h2>Blog项目的迁移</h2> <p>本座主要的开发栈不是ruby，所以那套东西都放docker。配置好gem的镜像，安装最新的jekyll之后，创建一个干净的静态网站：</p> <figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span></span>$ gem install jekyll
</span><span class='line'>$ jekyll new my-site <span class="o">&amp;&amp;</span> <span class="nb">cd</span> my-site
</span></code></pre></td></tr></table></div></figure> <p>然后把blog的源文件以及一些静态文件放到对应的目录，然后按照新老项目的<code>_config.yml</code>文件内容，挨个的排查之前的插件和配置情况。</p> <p>比如之前Octopress因为有自己的代码高亮和引用插件，你的日志里面可能有<code>codeblock</code>这样的不是默认支持的tag，在<code>jekyll build</code>过程中导致构建失败。</p> <p>要解决这种问题有两个思路：</p> <ol> <li>把Octopress的插件移植一遍</li> <li>把日志改成使用默认支持的语法</li> </ol> <p>实际过程里面本座的做法大概是一半一半。比如像插入gist，blockquote这些现在默认也支持得挺好的功能插件，就去掉了它们，然后通过正则表达式对<code>_posts</code>目录下的文章进行全局替换。</p> <p>而有些个人觉得Octopress确实解决得不错的功能，就按照<a href="https://jekyllrb.com/docs/plugins/">新版Jekyll插件</a>的语法进行了迁移，这部分包括对日期的处理，图片的插入等等。</p> <p>这些大体修改完毕，然后安装相应的依赖（可以对比新旧的Gemfile，只需要安装自己的插件用到的依赖），这部分改动就大概完成了。</p> <a name="L....................."></a> <h2>模板项目的迁移</h2> <p>因为Jekyll自己的模板是基于gem-based的，也就是说你首先得新建一个gem-based的项目：</p> <ol> <li>注册<a href="https://rubygems.org">rubygems</a>的账号</li> <li>新建项目，并按照gem的方式组织代码并发布模板</li> <li>在Blog项目的<code>_config.yml</code>里面引用这个模板</li> </ol> <p>最终的工作就是我又多了一个gem-based的<a href="https://github.com/lenciel/jekyll-lenciel-theme">Jekyll模板项目</a>。</p> <p>这部分要特别注意的就是Jekyll的模板项目默认能够发布的目录（也就是包含在gemfile里面，能够被你的Blog项目在安装路径找到的目录）非常有限：</p> <blockquote><p>Jekyll will look first to your site’s content before looking to the theme’s defaults for any requested file in the following folders:</p> <p>/assets /<em>layouts /</em>includes /_sass</p></blockquote> <p>如果你有很多其他目录希望一起发布，可以修改<code>gemspec</code>里面的相关选项：</p> <figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span></span><span class="n">spec</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="sb">`git ls-files -z`</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x0</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">f</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">%r{^(assets|_layouts|_includes|_sass|LICENSE|README|index)}i</span><span class="p">)</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure> <p>还有一点就是这种发布和安装模板的方式，会破坏很多对静态资源的处理流程（如果有的话）。</p> <p>比如我自己会对图片自动压缩，对css/js文件进行合并和uglify等等。这些工作的目标文件因为很多都在gem安装的模板里面，会变得比较tricky。最终本座只好对<code>jekyll build</code>之后的<code>_site</code>目录下的部署目标文件进行处理。</p> <a name="L......"></a> <h2>其他</h2> <p>虽然放弃了Octopress，但并不是说Octopress是个失败的项目。一方面，它的完成度很高，如果你不是有本座一些龟毛的要求（要自己搞模板，要对静态文件做优化，要支持各种国内才需要支持的定制），已经够用。作者一个人要跟上Jekyll一个社区的开发速度，本来就很难，是属于可以理解的不足。并且，通过看它的插件源代码，对我自己的模板实现也起到了很大帮助。</p> <p>所以，感谢Octopress引进门，用了它，折腾Jekyll就容易多了。</p> </div> <footer> <p class="meta"> <span class="byline author vcard">Posted by <span class="fn">Lenciel</span></span> <span class="categories"> <a class='category' href='/categories/blog/'>blog</a>, <a class='category' href='/categories/jekyll/'>jekyll</a>, <a class='category' href='/categories/octopress/'>octopress</a>, <a class='category' href='/categories/tools-i-use/'>tools-i-use</a> </span> </p> <div class="sharing"> </div> <p class="meta"> <a class="basic-alignment left" href="/2017/03/msa-in-practice/" title="Previous Post: 关于微服务实践的一次分享">&laquo; 关于微服务实践的一次分享</a> <a class="basic-alignment right" href="/2017/03/add-supporting-for-ssl-and-http2/" title="Next Post: 增加ssl证书和对http2的支持">增加ssl证书和对http2的支持 &raquo;</a> </p> </footer> </article> </div> </div> </div> <footer role="contentinfo"><p> Blog theme: <a href="https://github.com/lenciel/jekyll-lenciel-theme">jekyll-lenciel-theme</a> <span class="theme-version">Copyright &copy; 2004-2017 by <a href="mailto:lenciel@gmail.com">Lenciel</a></span> </p> </footer> <script type="text/javascript">
  var stylesheet = document.createElement('link');
  stylesheet.href = '/assets/stylesheets/app.css';
  stylesheet.rel = 'stylesheet';
  stylesheet.type = 'text/css';
  document.getElementsByTagName('head')[0].appendChild(stylesheet);
</script> </body> </html>